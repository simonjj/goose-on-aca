# yaml-language-server: $schema=https://raw.githubusercontent.com/Azure/azure-dev/main/schemas/v1.0/azure.yaml.json

name: goose-on-aca
metadata:
  template: goose-on-aca@0.0.1-beta

workflows:
  up:
    steps:
      - azd: provision
      - azd: deploy --all

infra:
  provider: bicep
  path: infra
  module: main
  parameters:
    proxyAuthPassword:
      value: ${PROXY_AUTH_PASSWORD}

hooks:
  preprovision:
    run: ./hooks/set-proxy-password.sh
    shell: sh
    windows:
      run: ./hooks/set-proxy-password.ps1
      shell: pwsh

services:
  goose-agent:
    project: ./app/goose
    host: containerapp
    language: docker
  
  ollama:
    project: ./app/ollama
    host: containerapp
    language: docker

  nginx-auth-proxy:
    project: ./app/nginx-auth-proxy
    host: containerapp
    language: docker